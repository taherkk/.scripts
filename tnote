#!/bin/bash

notesdir=$HOME/Dropbox/NOTES/
notelinkdir=$HOME/Notes/
confirmation="I am sure I want to delete this note"

[[ -d $notelinkdir ]] && : || mkdir -p $notelinkdir
[[ -d $notesdir ]] && : || mkdir -p $notesdir

getNote(){
	echo "$(echo -e "$(ls $notelinkdir)" | dmenu -l 10 -p "Select Note: ")"
}

while getopts ":c:dor:" arg > /dev/null; do
	case $arg in
		c)option=c;filename=$OPTARG;;
		d)option=d;;
		r)option=r;filename=$OPTARG;;
		o)option=o;;
	esac
done

if [[ $option == c || $option == create ]];then
	touch $notesdir$filename
	ln -s $notesdir$filename $notelinkdir
	if [[ -e $notesdir$filename && -e $notelinkdir$filename ]];then
		notify-send "Note $filename created" 2> /dev/null
		$TERMINAL -e nvim $notelinkdir$filename &
	fi
elif [[ $option == d || $option == delete ]];then
	note=$(getNote)
	if [[ ! -z $note ]];then
		mv $notesdir$note ~/.trash/
		rm $notelinkdir$note 
		[[ ! -e $notesdir$note && ! -e $notelinkdir$note ]] && notify-send "Note $note deleted."
	fi
elif [[ $option == o ]];then
	note=$(getNote)
	[[ ! -z $note ]] && $TERMINAL -e nvim "$notelinkdir$note"
elif [[ $option == r ]]; then
	read -p "Enter new filename" newfilename
	mv $notesdir$filename $notesdir$newfilename
	rm $notelinkdir$filename
	ln -s $notesdir$newfilename $notelinkdir
fi
